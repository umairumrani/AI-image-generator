<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Image Generator</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #4338ca;
      margin-top: 0;
    }
    .form-group {
      margin-bottom: 20px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background-color: #4338ca;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      display: block;
      margin: 0 auto;
    }
    button:disabled {
      background-color: #a5a5a5;
      cursor: not-allowed;
    }
    .error {
      color: #e53e3e;
      margin-top: 10px;
    }
    .loading {
      text-align: center;
      margin: 20px 0;
    }
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(0,0,0,0.1);
      border-radius: 50%;
      border-top-color: #4338ca;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .result {
      text-align: center;
      margin-top: 20px;
    }
    .result img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .prompt {
      margin-top: 10px;
      font-style: italic;
      color: #666;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI Image Generator</h1>
    
    <div class="form-group">
      <input 
        type="text" 
        id="prompt-input" 
        placeholder="Enter a description of the image you want to create..."
      >
      <div id="error" class="error hidden"></div>
    </div>
    
    <button id="generate-btn">Generate Image</button>
    
    <div id="loading" class="loading hidden">
      <div class="spinner"></div>
      <p>Creating your image...</p>
    </div>
    
    <div id="result" class="result hidden">
      <img id="result-image" src="" alt="">
      <p id="result-prompt" class="prompt"></p>
    </div>
  </div>

  <script>
    // Elements
    const promptInput = document.getElementById('prompt-input');
    const generateBtn = document.getElementById('generate-btn');
    const errorElement = document.getElementById('error');
    const loadingElement = document.getElementById('loading');
    const resultElement = document.getElementById('result');
    const resultImage = document.getElementById('result-image');
    const resultPrompt = document.getElementById('result-prompt');
    
    // API Key
    const API_KEY = 'sk-lKVFlxV2g1QDr0wTPVwz9nzFEbmyH1SGIY1RytHAo9xgazTF';
    
    // Event listener
    generateBtn.addEventListener('click', generateImage);
    
    // Generate image function
    async function generateImage() {
      const prompt = promptInput.value.trim();
      
      // Validate prompt
      if (!prompt) {
        showError('Please enter a description');
        return;
      }
      
      // Show loading state
      showLoading();
      
      try {
        // Create a new XMLHttpRequest
        const xhr = new XMLHttpRequest();
        
        // Configure it to be asynchronous
        xhr.open('POST', 'https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image', true);
        
        // Set headers
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('Authorization', `Bearer ${API_KEY}`);
        xhr.setRequestHeader('Accept', 'application/json');
        
        // Set up response handler
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              try {
                const response = JSON.parse(xhr.responseText);
                const imageData = response.artifacts[0];
                const imageUrl = `data:image/png;base64,${imageData.base64}`;
                
                // Display the image
                resultImage.src = imageUrl;
                resultPrompt.textContent = prompt;
                showResult();
              } catch (error) {
                showError('Error processing the response');
                console.error('Error parsing response:', error);
              }
            } else {
              let errorMessage = 'Failed to generate image';
              try {
                const errorResponse = JSON.parse(xhr.responseText);
                if (errorResponse.message) {
                  errorMessage = errorResponse.message;
                }
              } catch (e) {
                // Use default error message
              }
              showError(errorMessage);
            }
            hideLoading();
          }
        };
        
        // Prepare the request data
        const data = {
          text_prompts: [
            {
              text: prompt,
              weight: 1
            }
          ],
          cfg_scale: 7,
          height: 1024,
          width: 1024,
          samples: 1,
          steps: 25
        };
        
        // Send the request
        xhr.send(JSON.stringify(data));
        
      } catch (error) {
        hideLoading();
        showError('Error generating image: ' + error.message);
        console.error('Error:', error);
      }
    }
    
    // Helper functions
    function showLoading() {
      loadingElement.classList.remove('hidden');
      resultElement.classList.add('hidden');
      errorElement.classList.add('hidden');
      generateBtn.disabled = true;
    }
    
    function hideLoading() {
      loadingElement.classList.add('hidden');
      generateBtn.disabled = false;
    }
    
    function showResult() {
      resultElement.classList.remove('hidden');
    }
    
    function showError(message) {
      errorElement.textContent = message;
      errorElement.classList.remove('hidden');
    }
  </script>
</body>
</html>
